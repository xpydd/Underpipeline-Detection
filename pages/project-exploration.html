<!DOCTYPE html>
<html class="" lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>项目勘探 - 管网智慧探测系统</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="js/project-navigation.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#5ad98b",
                        "background-light": "#f6f8f7",
                        "background-dark": "#131f18"
                    },
                    fontFamily: {
                        display: ["Inter", "PingFang SC", "Microsoft YaHei", "sans-serif"]
                    },
                    borderRadius: {
                        DEFAULT: "0.25rem",
                        lg: "0.5rem",
                        xl: "0.75rem",
                        full: "9999px"
                    }
                }
            }
        };
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #475569;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 min-h-screen flex flex-col">

<!-- 头部导航 -->
<header class="border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-[#161e27] sticky top-0 z-50 shrink-0">
    <div class="max-w-[1440px] mx-auto px-6 h-16 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <a href="../index.html" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
                <div class="bg-primary p-1.5 rounded-lg flex items-center justify-center">
                    <span class="material-symbols-outlined text-white text-2xl" data-icon="settings_input_component">settings_input_component</span>
                </div>
                <h1 class="text-lg font-bold tracking-tight text-slate-800 dark:text-white">管网多模态全过程智慧探测系统</h1>
            </a>
            <span class="text-slate-300 dark:text-slate-600">/</span>
            <span class="text-sm font-medium text-slate-900 dark:text-white truncate max-w-[200px]" id="breadcrumb-project-name">深圳市龙岗区中心小学新建项目</span>
        </div>
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3 border-r border-slate-200 dark:border-slate-800 pr-6 mr-2">
                <div class="text-right">
                    <p class="text-sm font-bold leading-none mb-1">陈明</p>
                    <p class="text-[11px] text-slate-500 dark:text-slate-400 font-medium">基础设施部</p>
                </div>
            </div>
            <button class="p-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors">
                <span class="material-symbols-outlined" data-icon="notifications">notifications</span>
            </button>
        </div>
    </div>
</header>

<!-- 主内容区域 -->
<main class="flex-1 max-w-[1440px] w-full mx-auto px-6 pt-6 pb-12">
    <!-- 项目级头部区域 -->
    <div class="mb-4 space-y-2">
        <!-- 标题与操作 -->
        <div class="flex justify-between items-center h-10">
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-3">
                    <h2 class="text-xl font-bold text-slate-800 dark:text-white" id="project-title">深圳市龙岗区中心小学新建项目</h2>
                    <div class="flex items-center gap-2 text-xs text-slate-500 border-l border-slate-200 dark:border-slate-700 pl-3">
                        <span class="font-mono bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-slate-600 dark:text-slate-400 scale-90" id="project-id">PROJ-2024-001</span>
                        <span class="flex items-center gap-0.5 scale-90 origin-left"><span class="material-symbols-outlined text-sm">location_on</span> <span id="project-address">深圳市龙岗区</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 一级菜单 (Top Tabs) -->
        <div class="border-b border-slate-200 dark:border-slate-800">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                <a href="#" class="border-primary text-primary flex items-center gap-1.5 whitespace-nowrap pb-2 px-1 border-b-2 font-bold text-sm">
                    <span class="material-symbols-outlined text-base">work</span>
                    工作平台
                </a>
                <a href="#" class="border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:border-slate-300 flex items-center gap-1.5 whitespace-nowrap pb-2 px-1 border-b-2 font-medium text-sm transition-colors">
                    <span class="material-symbols-outlined text-base">menu_book</span>
                    知识中心
                </a>
            </nav>
        </div>
    </div>

    <!-- 页面布局：左侧导航 + 右侧内容 -->
    <div class="flex gap-4 items-start h-[calc(100vh-10rem)]">
        <!-- 二级菜单 (Left Sidebar) -->
        <nav class="w-16 shrink-0 space-y-2 sticky top-0 flex flex-col items-center py-2 bg-white dark:bg-[#161e27] rounded-lg border border-slate-200 dark:border-slate-800 h-full z-50">
            <a href="project-detail.html" class="w-10 h-10 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-700 dark:hover:text-slate-200 flex items-center justify-center rounded-lg transition-colors group relative" title="项目">
                <span class="material-symbols-outlined text-[24px]">dashboard</span>
                <span class="absolute left-full ml-2 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">项目</span>
            </a>
            <a href="#" class="w-10 h-10 bg-primary/10 text-primary flex items-center justify-center rounded-lg transition-colors group relative" title="勘探">
                <span class="material-symbols-outlined text-[24px]">explore</span>
                <span class="absolute left-full ml-2 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">勘探</span>
            </a>
            <a href="project-data.html" class="w-10 h-10 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-700 dark:hover:text-slate-200 flex items-center justify-center rounded-lg transition-colors group relative" title="数据">
                <span class="material-symbols-outlined text-[24px]">database</span>
                <span class="absolute left-full ml-2 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">数据</span>
            </a>
            <a href="project-model.html" class="w-10 h-10 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-700 dark:hover:text-slate-200 flex items-center justify-center rounded-lg transition-colors group relative" title="模型">
                <span class="material-symbols-outlined text-[24px]">view_in_ar</span>
                <span class="absolute left-full ml-2 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">模型</span>
            </a>
            <a href="project-report.html" class="w-10 h-10 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-700 dark:hover:text-slate-200 flex items-center justify-center rounded-lg transition-colors group relative" title="报告">
                <span class="material-symbols-outlined text-[24px]">description</span>
                <span class="absolute left-full ml-2 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">报告</span>
            </a>
        </nav>

        <!-- 内容区域 -->
        <div class="flex-1 min-w-0 h-full overflow-hidden relative">
            <!-- 勘探视图 -->
            <div class="w-full h-full flex gap-4">
                <!-- 左侧列表: 勘探作业菜单 -->
                <div class="w-[25%] bg-white dark:bg-[#161e27] rounded-lg border border-slate-200 dark:border-slate-800 flex flex-col">
                    <div class="p-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                        <h3 class="font-bold text-slate-800 dark:text-white text-sm flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary text-base">category</span>
                            勘探作业菜单
                        </h3>
                    </div>
                    <div class="flex-1 overflow-y-auto p-3 space-y-4 custom-scrollbar">

                        <!-- Section 1: 探地雷达 -->
                        <div class="space-y-2">
                            <h4 class="text-xs font-bold text-slate-500 dark:text-slate-400 flex items-center gap-1">
                               <span class="w-1 h-3 bg-blue-500 rounded-full"></span>
                               探地雷达
                            </h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="document.getElementById('radarScanModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-blue-50 dark:hover:bg-slate-700 hover:text-blue-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-blue-500">radar</span>
                                    <span class="text-xs font-medium">扫描数据</span>
                                </button>
                                <button onclick="document.getElementById('surveyIssuesModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-orange-50 dark:hover:bg-slate-700 hover:text-orange-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-orange-500">report_problem</span>
                                    <span class="text-xs font-medium">勘测问题</span>
                                </button>
                            </div>
                        </div>

                        <!-- Section 2: 管线探测仪 -->
                        <div class="space-y-2">
                            <h4 class="text-xs font-bold text-slate-500 dark:text-slate-400 flex items-center gap-1">
                               <span class="w-1 h-3 bg-purple-500 rounded-full"></span>
                               管线探测仪
                            </h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="document.getElementById('drawPipePointModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-purple-50 dark:hover:bg-slate-700 hover:text-purple-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-purple-500">share_location</span>
                                    <span class="text-xs font-medium">绘制管点</span>
                                </button>
                                <button onclick="document.getElementById('drawPipelineModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-purple-50 dark:hover:bg-slate-700 hover:text-purple-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                   <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-purple-500">timeline</span>
                                   <span class="text-xs font-medium">绘制管线</span>
                               </button>
                                <button class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-purple-50 dark:hover:bg-slate-700 hover:text-purple-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-purple-500">add_circle</span>
                                    <span class="text-xs font-medium">管线加点</span>
                                </button>
                                <button onclick="document.getElementById('pointSearchModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-purple-50 dark:hover:bg-slate-700 hover:text-purple-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-purple-500">search</span>
                                    <span class="text-xs font-medium">管点搜索</span>
                                </button>
                                <button onclick="document.getElementById('coordinateInputModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-purple-50 dark:hover:bg-slate-700 hover:text-purple-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-purple-500">edit_location</span>
                                    <span class="text-xs font-medium">坐标输入</span>
                                </button>
                                <button onclick="document.getElementById('surveyIssuesModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-orange-50 dark:hover:bg-slate-700 hover:text-orange-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-orange-500">report_problem</span>
                                    <span class="text-xs font-medium">勘测问题</span>
                                </button>
                            </div>
                        </div>

                        <!-- Section 3: 人工勘察 -->
                        <div class="space-y-2">
                            <h4 class="text-xs font-bold text-slate-500 dark:text-slate-400 flex items-center gap-1">
                               <span class="w-1 h-3 bg-orange-500 rounded-full"></span>
                               人工勘察
                            </h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="document.getElementById('drawPipePointModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-orange-50 dark:hover:bg-slate-700 hover:text-orange-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-orange-500">share_location</span>
                                    <span class="text-xs font-medium">绘制管点</span>
                                </button>
                                <button onclick="document.getElementById('drawPipelineModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-orange-50 dark:hover:bg-slate-700 hover:text-orange-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                   <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-orange-500">timeline</span>
                                   <span class="text-xs font-medium">绘制管线</span>
                               </button>
                                <button class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-orange-50 dark:hover:bg-slate-700 hover:text-orange-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-orange-500">add_circle</span>
                                    <span class="text-xs font-medium">管线加点</span>
                                </button>
                                <button onclick="document.getElementById('pointSearchModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-orange-50 dark:hover:bg-slate-700 hover:text-orange-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-orange-500">search</span>
                                    <span class="text-xs font-medium">管点搜索</span>
                                </button>
                                <button onclick="document.getElementById('coordinateInputModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-orange-50 dark:hover:bg-slate-700 hover:text-orange-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-orange-500">edit_location</span>
                                    <span class="text-xs font-medium">坐标输入</span>
                                </button>
                                <button onclick="document.getElementById('surveyIssuesModal').showModal()" class="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 dark:bg-slate-800 hover:bg-orange-50 dark:hover:bg-slate-700 hover:text-orange-600 border border-slate-200 dark:border-slate-700 rounded-lg transition-all group">
                                    <span class="material-symbols-outlined text-xl text-slate-400 group-hover:text-orange-500">report_problem</span>
                                    <span class="text-xs font-medium">勘测问题</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- 右侧地图: Huge Map -->
                <div class="flex-1 bg-slate-900 rounded-lg relative overflow-hidden group border border-slate-800">
                    <!-- 顶部操作栏 (Top Bar) -->
                    <div class="absolute top-4 left-4 right-4 z-10 flex justify-between items-start pointer-events-none">
                        <!-- Left Controls (Pointer Events Auto) -->
                        <div class="flex gap-3 pointer-events-auto">
                            <!-- 勘探手段筛选 -->
                           <div class="bg-slate-800/90 backdrop-blur border border-slate-700 rounded p-2 text-white text-xs shadow-lg">
                               <div class="font-bold mb-2 pb-1 border-b border-slate-700 flex justify-between items-center cursor-pointer">
                                   <span>勘探手段</span>
                                   <span class="material-symbols-outlined text-sm">filter_alt</span>
                               </div>
                               <div class="space-y-1.5">
                                   <label class="flex items-center gap-2 cursor-pointer hover:text-blue-400">
                                       <input type="radio" name="explore-method" value="all" checked class="rounded-full border-slate-600 bg-slate-700 text-blue-500 focus:ring-0 size-3">
                                       全部勘探手段
                                   </label>
                                   <label class="flex items-center gap-2 cursor-pointer hover:text-blue-400">
                                       <input type="radio" name="explore-method" value="gpr" class="rounded-full border-slate-600 bg-slate-700 text-blue-500 focus:ring-0 size-3">
                                       探地雷达
                                   </label>
                                   <label class="flex items-center gap-2 cursor-pointer hover:text-purple-400">
                                       <input type="radio" name="explore-method" value="pipeline" class="rounded-full border-slate-600 bg-slate-700 text-purple-500 focus:ring-0 size-3">
                                       管线探测仪
                                   </label>
                                   <label class="flex items-center gap-2 cursor-pointer hover:text-orange-400">
                                       <input type="radio" name="explore-method" value="manual" class="rounded-full border-slate-600 bg-slate-700 text-orange-500 focus:ring-0 size-3">
                                       人工勘察
                                   </label>
                               </div>
                           </div>
                            <!-- 现场人员 -->
                           <div class="h-fit bg-white/90 dark:bg-slate-800/90 backdrop-blur rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 px-3 py-1.5 flex items-center gap-2">
                               <span class="material-symbols-outlined text-primary text-base">engineering</span>
                               <span class="text-xs text-slate-500">现场勘探:</span>
                               <span class="text-sm font-bold text-slate-800 dark:text-white" id="exploration-personnel">-</span>
                           </div>
                        </div>
                    </div>

                    <!-- 3D Map Content -->
                    <div class="absolute inset-0 bg-gradient-to-b from-slate-900 to-[#0f172a]">
                        <div class="absolute inset-0 opacity-20"
                             style="background-image: linear-gradient(#334155 1px, transparent 1px), linear-gradient(90deg, #334155 1px, transparent 1px);
                                    background-size: 50px 50px;
                                    transform: perspective(500px) rotateX(60deg) translateY(100px) scale(2);">
                        </div>
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white/20 text-4xl font-bold select-none pointer-events-none">
                            Exploration 3D Space
                        </div>
                    </div>

                    <!-- Common Map Controls -->
                    <div class="absolute bottom-4 right-4 flex flex-col gap-2">
                        <button class="size-8 bg-slate-800/90 backdrop-blur border border-slate-700 rounded text-white hover:bg-slate-700 flex items-center justify-center shadow-lg"><span class="material-symbols-outlined text-lg">add</span></button>
                        <button class="size-8 bg-slate-800/90 backdrop-blur border border-slate-700 rounded text-white hover:bg-slate-700 flex items-center justify-center shadow-lg"><span class="material-symbols-outlined text-lg">remove</span></button>
                    </div>
                </div>
           </div>
        </div>
    </div>
</main>
</body>
</html>
<!-- 管点搜索弹窗 -->
<dialog id="pointSearchModal" class="bg-transparent backdrop:bg-slate-900/50 backdrop:backdrop-blur-sm p-0 w-full max-w-md open:animate-in open:fade-in open:zoom-in-95 closed:animate-out closed:fade-out closed:zoom-out-95 z-[100]">
    <div class="bg-white dark:bg-[#161e27] rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden">
        <!-- Header -->
        <div class="px-4 py-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
            <h3 class="text-base font-bold text-slate-800 dark:text-white">管点搜索</h3>
            <button onclick="document.getElementById('pointSearchModal').close()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>
        </div>

        <!-- Content -->
        <div class="p-6 space-y-4">
            <div class="space-y-2">
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">管点编号</label>
                <input type="text" id="pointSearchInput" placeholder="请输入管点编号" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none">
            </div>

            <button onclick="searchPoint()" class="w-full px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-primary/90 rounded-lg transition-colors">
                查询
            </button>
        </div>
    </div>
</dialog>

<!-- 雷达扫描弹窗 -->
<dialog id="radarScanModal" class="bg-transparent backdrop:bg-slate-900/50 backdrop:backdrop-blur-sm p-0 w-full max-w-4xl open:animate-in open:fade-in open:zoom-in-95 closed:animate-out closed:fade-out closed:zoom-out-95 z-[100]">
    <div class="bg-white dark:bg-[#161e27] rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[90vh]">
        <!-- Header -->
        <div class="px-4 py-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center shrink-0">
            <h3 class="text-base font-bold text-slate-800 dark:text-white">雷达扫描</h3>
            <button onclick="document.getElementById('radarScanModal').close()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4">
            <!-- 设备连接 Section -->
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <h4 class="text-sm font-bold text-slate-800 dark:text-white">设备连接</h4>
                    <button onclick="connectDevice()" class="px-3 py-1 text-xs font-medium text-primary hover:text-primary/80 border border-primary rounded transition-colors">
                        >>
                    </button>
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <div class="p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg space-y-2">
                        <div class="flex items-center justify-between">
                            <input type="radio" name="device" id="device1" value="LD-GTL310-66P" class="text-primary focus:ring-primary">
                            <label for="device1" class="flex-1 ml-2 text-xs font-medium text-slate-700 dark:text-slate-300">LD-GTL310-66P</label>
                        </div>
                        <div class="flex items-center gap-1.5">
                            <span class="size-2 rounded-full bg-slate-400"></span>
                            <span class="text-[10px] text-slate-500">已断开</span>
                        </div>
                    </div>
                    <div class="p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg space-y-2">
                        <div class="flex items-center justify-between">
                            <input type="radio" name="device" id="device2" value="LD-GTL310-77P" class="text-primary focus:ring-primary">
                            <label for="device2" class="flex-1 ml-2 text-xs font-medium text-slate-700 dark:text-slate-300">LD-GTL310-77P</label>
                        </div>
                        <div class="flex items-center gap-1.5">
                            <span class="size-2 rounded-full bg-slate-400"></span>
                            <span class="text-[10px] text-slate-500">已断开</span>
                        </div>
                    </div>
                    <div class="p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg space-y-2">
                        <div class="flex items-center justify-between">
                            <input type="radio" name="device" id="device3" value="LD-GTL310-88P" class="text-primary focus:ring-primary">
                            <label for="device3" class="flex-1 ml-2 text-xs font-medium text-slate-700 dark:text-slate-300">LD-GTL310-88P</label>
                        </div>
                        <div class="flex items-center gap-1.5">
                            <span class="size-2 rounded-full bg-slate-400"></span>
                            <span class="text-[10px] text-slate-500">已断开</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 数据传输 Section -->
            <div class="space-y-3">
                <h4 class="text-sm font-bold text-slate-800 dark:text-white">数据传输</h4>

                <!-- 项目编号 -->
                <div class="space-y-2">
                    <label class="text-xs font-medium text-slate-600 dark:text-slate-400">项目编号</label>
                    <div class="flex flex-wrap gap-2" id="projectNumberContainer">
                        <span class="text-xs text-slate-400">请先连接设备</span>
                    </div>
                </div>

                <!-- 项目数据 -->
                <div class="space-y-2">
                    <label class="text-xs font-medium text-slate-600 dark:text-slate-400">项目数据</label>
                    <div class="flex flex-wrap gap-2" id="projectDataContainer">
                        <span class="text-xs text-slate-400">请先选择项目编号</span>
                    </div>
                </div>

                <!-- 数据类型 -->
                <div class="space-y-2">
                    <label class="text-xs font-medium text-slate-600 dark:text-slate-400">数据类型</label>
                    <div class="flex flex-wrap gap-2">
                        <label class="inline-flex items-center gap-1.5 px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                            <input type="checkbox" value="基础信息" class="text-primary focus:ring-primary rounded" onchange="updateDataTypeSelection()">
                            <span class="text-xs text-slate-700 dark:text-slate-300">基础信息</span>
                        </label>
                        <label class="inline-flex items-center gap-1.5 px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                            <input type="checkbox" value="图像文件" class="text-primary focus:ring-primary rounded" onchange="updateDataTypeSelection()">
                            <span class="text-xs text-slate-700 dark:text-slate-300">图像文件</span>
                        </label>
                    </div>
                </div>

                <!-- 传输控制 -->
                <div class="space-y-3 pt-2">
                    <div class="flex items-center gap-2">
                        <button id="startTransferBtn" onclick="startTransfer()" class="px-4 py-1.5 text-xs font-medium text-white bg-primary hover:bg-primary/90 rounded transition-colors">
                            开始传输
                        </button>
                        <button id="pauseTransferBtn" onclick="pauseTransfer()" disabled class="px-4 py-1.5 text-xs font-medium text-slate-400 bg-slate-200 dark:bg-slate-700 rounded cursor-not-allowed">
                            暂停传输
                        </button>
                        <button id="resumeTransferBtn" onclick="resumeTransfer()" disabled class="px-4 py-1.5 text-xs font-medium text-slate-400 bg-slate-200 dark:bg-slate-700 rounded cursor-not-allowed">
                            继续传输
                        </button>
                    </div>

                    <!-- 进度条 -->
                    <div class="space-y-1">
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-slate-600 dark:text-slate-400">传输进度</span>
                            <span class="font-medium text-slate-700 dark:text-slate-300" id="transferProgress">0%</span>
                        </div>
                        <div class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                            <div id="transferProgressBar" class="h-full bg-primary transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="px-4 py-3 border-t border-slate-100 dark:border-slate-800 flex justify-between items-center shrink-0">
            <button onclick="document.getElementById('surveyIssuesModal').showModal()" class="text-xs font-medium text-primary hover:text-primary/80 transition-colors">
            
            </button>
            <div class="flex gap-2">
                <button onclick="document.getElementById('radarScanModal').close()" class="px-4 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-100 dark:hover:bg-slate-800 rounded transition-colors">
                    取消
                </button>
                <button onclick="confirmRadarScan()" class="px-4 py-1.5 text-xs font-medium text-white bg-primary hover:bg-primary/90 rounded transition-colors">
                    确定
                </button>
            </div>
        </div>
    </div>
</dialog>

<!-- 绘制管点模态框 -->
<dialog id="drawPipePointModal" class="bg-transparent backdrop:bg-slate-900/50 backdrop:backdrop-blur-sm p-0 w-full max-w-3xl open:animate-in open:fade-in open:zoom-in-95 closed:animate-out closed:fade-out closed:zoom-out-95 z-[100]">
    <div class="bg-white dark:bg-[#161e27] rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[85vh]">
        <!-- Header -->
        <div class="px-4 py-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center shrink-0">
            <h3 class="text-base font-bold text-slate-800 dark:text-white">绘制管点</h3>
            <button onclick="document.getElementById('drawPipePointModal').close()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>
        </div>
        
        <form method="dialog" class="flex flex-col flex-1 overflow-hidden">
            <div class="p-4 overflow-y-auto custom-scrollbar space-y-5">
                
                <!-- 1. 基本信息 -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-slate-800 dark:text-white flex items-center gap-1.5 pb-1.5 border-b border-slate-100 dark:border-slate-800">
                        <span class="material-symbols-outlined text-primary text-base">info</span>
                        基本信息
                    </h4>
                    <div class="grid grid-cols-3 gap-x-4 gap-y-3">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">管点编号</label>
                            <input type="text" value="DL001" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">管点种类</label>
                            <select id="pointTypeSelect" onchange="updateFeatureOptions()" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="">请选择管点种类</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">特征点</label>
                            <select id="featureSelect" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="">请先选择管点种类</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">附属物</label>
                            <select class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="none">无</option>
                                <option value="manhole">窨井</option>
                                <option value="valve_well">阀门井</option>
                                <option value="meter_well">仪表井</option>
                                <option value="inspection_well">检测井</option>
                                <option value="sewage_well">排污井</option>
                                <option value="rain_well">雨水井</option>
                                <option value="hand_hole">手孔</option>
                                <option value="person_hole">人孔</option>
                                <option value="cable_marker">电缆标示桩</option>
                                <option value="pipeline_marker">管线标示桩</option>
                                <option value="valve_box">阀门箱</option>
                                <option value="meter_box">仪表箱</option>
                                <option value="distribution_box">配电箱</option>
                                <option value="transformer_box">变压器箱</option>
                                <option value="control_box">控制箱</option>
                                <option value="fire_hydrant">消火栓</option>
                                <option value="vent">通风口</option>
                                <option value="drain_outlet">排水口</option>
                                <option value="catch_basin">雨水口</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">建设日期</label>
                            <input type="date" value="2018-11-12" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">权属单位</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                    </div>
                </div>

                <!-- 2. 管井信息 -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-slate-800 dark:text-white flex items-center gap-1.5 pb-1.5 border-b border-slate-100 dark:border-slate-800">
                        <span class="material-symbols-outlined text-primary text-base">water_drop</span>
                        管井信息
                    </h4>
                    <div class="grid grid-cols-3 gap-x-4 gap-y-3">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井盖材质</label>
                            <select class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="none">无</option>
                                <option value="metal">金属</option>
                                <option value="cast_iron">铸铁</option>
                                <option value="concrete">砼</option>
                                <option value="plastic">塑料</option>
                                <option value="steel">钢</option>
                                <option value="fiberglass">玻璃钢</option>
                                <option value="marble">大理石</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井盖类型</label>
                            <select class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="theft_proof">防盗</option>
                                <option value="non_theft_proof">非防盗</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井盖形状</label>
                            <select class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="circle">圆形</option>
                                <option value="rectangle">矩形</option>
                            </select>
                        </div>
                        
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井盖尺寸</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井室规格</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井室尺寸</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>

                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井室尺寸</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井脖尺寸</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">井脖深</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                    </div>
                </div>

                <!-- 3. 空间信息 -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-slate-800 dark:text-white flex items-center gap-1.5 pb-1.5 border-b border-slate-100 dark:border-slate-800">
                        <span class="material-symbols-outlined text-primary text-base">location_on</span>
                        空间信息
                    </h4>
                    <div class="grid grid-cols-3 gap-x-4 gap-y-3">
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">经度</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded text-xs text-slate-500 cursor-not-allowed" readonly>
                            <span class="absolute right-2 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right">(自动录入)</span>
                        </div>
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">纬度</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded text-xs text-slate-500 cursor-not-allowed" readonly>
                            <span class="absolute right-2 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right">(自动录入)</span>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">H高程</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                    </div>
                </div>

                <!-- 4. 其他信息 -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-slate-800 dark:text-white flex items-center gap-1.5 pb-1.5 border-b border-slate-100 dark:border-slate-800">
                        <span class="material-symbols-outlined text-primary text-base">description</span>
                        其他信息
                    </h4>
                    <div class="grid grid-cols-3 gap-x-4 gap-y-3">
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">调查日期</label>
                            <input type="text" value="2025/12/12" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            <span class="absolute right-2 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right">(自动录入)</span>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">建构筑物</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">备注</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                    </div>
                </div>

                <!-- 5. 影像信息 -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-slate-800 dark:text-white flex items-center gap-1.5 pb-1.5 border-b border-slate-100 dark:border-slate-800">
                        <span class="material-symbols-outlined text-primary text-base">image</span>
                        影像信息
                    </h4>
                    <div class="flex flex-wrap gap-3" id="imageUploadContainer">
                        <div onclick="document.getElementById('imageInput').click()" class="w-20 h-20 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-primary hover:text-primary text-slate-400 transition-colors bg-slate-50 dark:bg-slate-800/50 shrink-0">
                            <span class="material-symbols-outlined text-xl mb-0.5">add_photo_alternate</span>
                            <span class="text-[10px]">添加影像</span>
                        </div>
                        <input type="file" id="imageInput" multiple accept="image/*,video/*" class="hidden" onchange="handleImageUpload(this)">
                    </div>
                </div>

            </div>

            <div class="px-4 py-3 border-t border-slate-100 dark:border-slate-800 flex justify-end gap-2 bg-slate-50 dark:bg-[#161e27] shrink-0">
                <button value="cancel" formmethod="dialog" class="px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-200 rounded-lg transition-colors">取消</button>
                <button value="confirm" class="px-3 py-1.5 text-xs font-bold text-white bg-primary hover:bg-primary/90 rounded-lg shadow-lg shadow-primary/20 transition-all">确定</button>
            </div>
        </form>
    </div>
</dialog>

<!-- 坐标输入弹窗 -->
<dialog id="coordinateInputModal" class="bg-transparent backdrop:bg-slate-900/50 backdrop:backdrop-blur-sm p-0 w-full max-w-5xl open:animate-in open:fade-in open:zoom-in-95 closed:animate-out closed:fade-out closed:zoom-out-95 z-[100]">
    <div class="bg-white dark:bg-[#161e27] rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[90vh]">
        <!-- Header -->
        <div class="px-4 py-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center shrink-0">
            <div class="flex items-center gap-3">
                <h3 class="text-base font-bold text-slate-800 dark:text-white">坐标输入</h3>
                <button onclick="importCoordinates()" class="px-3 py-1 text-xs font-medium text-primary hover:text-primary/80 border border-primary rounded transition-colors flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">upload_file</span>
                    请拖拽输入编号>>
                </button>
                <button onclick="exportCoordinates()" class="px-3 py-1 text-xs font-medium text-primary hover:text-primary/80 border border-primary rounded transition-colors flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">download</span>
                    导入>>
                </button>
            </div>
            <button onclick="document.getElementById('coordinateInputModal').close()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>
        </div>

        <!-- Table -->
        <div class="flex-1 overflow-auto">
            <table class="w-full text-xs">
                <thead class="bg-slate-50 dark:bg-slate-900/50 sticky top-0">
                    <tr class="border-b border-slate-100 dark:border-slate-800">
                        <th class="px-4 py-2.5 text-center font-bold text-slate-600 dark:text-slate-300 w-32">物探编号</th>
                        <th class="px-4 py-2.5 text-center font-bold text-slate-600 dark:text-slate-300" colspan="2">平面坐标(m)</th>
                        <th class="px-4 py-2.5 text-center font-bold text-slate-600 dark:text-slate-300 w-28">高程(m)</th>
                        <th class="px-4 py-2.5 text-center font-bold text-slate-600 dark:text-slate-300 w-24">操作</th>
                    </tr>
                    <tr class="border-b border-slate-100 dark:border-slate-800">
                        <th class="px-4 py-2 text-center font-medium text-slate-500 dark:text-slate-400"></th>
                        <th class="px-4 py-2 text-center font-medium text-slate-500 dark:text-slate-400">X</th>
                        <th class="px-4 py-2 text-center font-medium text-slate-500 dark:text-slate-400">Y</th>
                        <th class="px-4 py-2 text-center font-medium text-slate-500 dark:text-slate-400"></th>
                        <th class="px-4 py-2 text-center font-medium text-slate-500 dark:text-slate-400"></th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100 dark:divide-slate-800" id="coordinateTableBody">
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                        <td class="px-4 py-3 text-center text-slate-700 dark:text-slate-300">DL001</td>
                        <td class="px-4 py-3">
                            <input type="text" value="2347184.253" class="w-full px-2 py-1 text-center bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </td>
                        <td class="px-4 py-3">
                            <input type="text" value="434427.064" class="w-full px-2 py-1 text-center bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </td>
                        <td class="px-4 py-3">
                            <input type="text" value="38.96" class="w-full px-2 py-1 text-center bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <button onclick="loadCoordinate(this)" class="text-primary hover:underline text-xs">载入</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Footer with Pagination -->
        <div class="px-4 py-3 border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-[#161e27] shrink-0">
            <div class="flex items-center justify-between">
                <div class="text-xs text-slate-600 dark:text-slate-400">
                    共<span id="totalRecords">10</span>页记录
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="goToPage(1)" class="px-2 py-1 text-xs border border-slate-300 dark:border-slate-600 rounded hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">1</button>
                    <button onclick="goToPage(2)" class="px-2 py-1 text-xs border border-slate-300 dark:border-slate-600 rounded hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">2</button>
                    <button onclick="goToPage(3)" class="px-2 py-1 text-xs border border-slate-300 dark:border-slate-600 rounded hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">3</button>
                    <button class="px-2 py-1 text-xs bg-primary text-white rounded">4</button>
                    <span class="text-xs text-slate-500">...</span>
                    <button onclick="goToPage(10)" class="px-2 py-1 text-xs border border-slate-300 dark:border-slate-600 rounded hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">10</button>
                    <span class="text-xs text-slate-600 dark:text-slate-400 mx-2">至</span>
                    <input type="number" value="7" class="w-12 px-2 py-1 text-xs text-center border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-800">
                    <span class="text-xs text-slate-600 dark:text-slate-400">页</span>
                    <button onclick="goToCustomPage()" class="px-2 py-1 text-xs border border-slate-300 dark:border-slate-600 rounded hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">>></button>
                </div>
                <div class="flex gap-2">
                    <button onclick="document.getElementById('coordinateInputModal').close()" class="px-4 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg transition-colors">取消</button>
                    <button onclick="confirmCoordinates()" class="px-4 py-1.5 text-xs font-bold text-white bg-primary hover:bg-primary/90 rounded-lg shadow-lg shadow-primary/20 transition-all">确定</button>
                </div>
            </div>
        </div>
    </div>
</dialog>

<!-- 影像资料预览弹窗 -->
<dialog id="imagePreviewModal" class="bg-transparent backdrop:bg-slate-900/80 backdrop:backdrop-blur-sm p-0 w-full max-w-5xl open:animate-in open:fade-in open:zoom-in-95 closed:animate-out closed:fade-out closed:zoom-out-95 z-[110]">
    <div class="bg-white dark:bg-[#161e27] rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[90vh]">
        <div class="px-4 py-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center shrink-0">
            <h3 class="text-base font-bold text-slate-800 dark:text-white">影像资料</h3>
            <div class="flex items-center gap-2">
                <button onclick="addIssueImages()" class="text-xs font-medium text-primary hover:text-primary/80 transition-colors flex items-center gap-1" id="addImageBtn">
                    <span class="material-symbols-outlined text-sm">add_photo_alternate</span>
                    添加
                </button>
                <input type="file" id="imagePreviewInput" multiple accept="image/*,video/*" class="hidden" onchange="handleImagePreviewUpload(this)">
                <button onclick="document.getElementById('imagePreviewModal').close()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                    <span class="material-symbols-outlined text-lg">close</span>
                </button>
            </div>
        </div>
        <div class="flex-1 overflow-auto p-4">
            <div class="grid grid-cols-3 gap-4" id="imagePreviewGrid">
                <!-- 影像资料将通过 JS 动态生成 -->
            </div>
        </div>
    </div>
</dialog>

<!-- 勘测问题弹窗 -->
<dialog id="surveyIssuesModal" class="bg-transparent backdrop:bg-slate-900/50 backdrop:backdrop-blur-sm p-0 w-full max-w-4xl open:animate-in open:fade-in open:zoom-in-95 closed:animate-out closed:fade-out closed:zoom-out-95 z-[100]">
    <div class="bg-white dark:bg-[#161e27] rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[85vh]">
        <!-- Header -->
        <div class="px-4 py-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center shrink-0">
            <h3 class="text-base font-bold text-slate-800 dark:text-white">勘测问题</h3>
            <div class="flex items-center gap-2">
                <button onclick="handleSurveyIssueAction('modify')" class="text-xs font-medium text-primary hover:text-primary/80 transition-colors flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">edit</span>
                    修改>>
                </button>
                <button onclick="handleSurveyIssueAction('add')" class="text-xs font-medium text-primary hover:text-primary/80 transition-colors flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">add_circle</span>
                    新增>>
                </button>
                <button onclick="handleSurveyIssueAction('export')" class="text-xs font-medium text-primary hover:text-primary/80 transition-colors flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">download</span>
                    导出>>
                </button>
                <button onclick="document.getElementById('surveyIssuesModal').close()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors ml-2">
                    <span class="material-symbols-outlined text-lg">close</span>
                </button>
            </div>
        </div>

        <div class="flex-1 overflow-auto">
            <table class="w-full text-xs">
                <thead class="bg-slate-50 dark:bg-slate-900/50 sticky top-0">
                    <tr class="border-b border-slate-100 dark:border-slate-800">
                        <th class="px-4 py-2.5 text-left font-bold text-slate-600 dark:text-slate-300 w-16">序号</th>
                        <th class="px-4 py-2.5 text-left font-bold text-slate-600 dark:text-slate-300">问题描述</th>
                        <th class="px-4 py-2.5 text-left font-bold text-slate-600 dark:text-slate-300">解决方案</th>
                        <th class="px-4 py-2.5 text-left font-bold text-slate-600 dark:text-slate-300 w-32">影像资料</th>
                        <th class="px-4 py-2.5 text-left font-bold text-slate-600 dark:text-slate-300 w-24">状态</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100 dark:divide-slate-800" id="surveyIssuesTableBody">
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" data-issue-id="1">
                        <td class="px-4 py-3 text-slate-700 dark:text-slate-300">1</td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="text-slate-700 dark:text-slate-300">YJ001处管井封闭无法作业</span>
                            </div>
                            <div class="edit-mode hidden">
                                <input type="text" value="YJ001处管井封闭无法作业" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="text-slate-600 dark:text-slate-400">联系业主单位协调开启</span>
                            </div>
                            <div class="edit-mode hidden">
                                <input type="text" value="联系业主单位协调开启" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="showImagePreview(1)" class="text-primary hover:underline flex items-center gap-1">
                                <span class="material-symbols-outlined text-sm">image</span>
                                查看(3)
                            </button>
                        </td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-red-50 text-red-600 text-[10px] font-medium border border-red-200">
                                    <span class="size-1.5 rounded-full bg-red-500"></span>
                                    待处理
                                </span>
                            </div>
                            <div class="edit-mode hidden flex gap-1">
                                <button onclick="saveIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-white bg-primary hover:bg-primary/90 rounded transition-colors">保存</button>
                                <button onclick="cancelIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors">取消</button>
                            </div>
                        </td>
                    </tr>
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" data-issue-id="2">
                        <td class="px-4 py-3 text-slate-700 dark:text-slate-300">2</td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="text-slate-700 dark:text-slate-300">YJ002处管线埋深超限</span>
                            </div>
                            <div class="edit-mode hidden">
                                <input type="text" value="YJ002处管线埋深超限" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="text-slate-600 dark:text-slate-400">采用探地雷达辅助探测</span>
                            </div>
                            <div class="edit-mode hidden">
                                <input type="text" value="采用探地雷达辅助探测" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="showImagePreview(2)" class="text-primary hover:underline flex items-center gap-1">
                                <span class="material-symbols-outlined text-sm">image</span>
                                查看(2)
                            </button>
                        </td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-600 text-[10px] font-medium border border-emerald-200">
                                    <span class="size-1.5 rounded-full bg-emerald-500"></span>
                                    已处理
                                </span>
                            </div>
                            <div class="edit-mode hidden flex gap-1">
                                <button onclick="saveIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-white bg-primary hover:bg-primary/90 rounded transition-colors">保存</button>
                                <button onclick="cancelIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors">取消</button>
                            </div>
                        </td>
                    </tr>
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" data-issue-id="3">
                        <td class="px-4 py-3 text-slate-700 dark:text-slate-300">3</td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="text-slate-700 dark:text-slate-300">YJ003处管线位置与图纸不符</span>
                            </div>
                            <div class="edit-mode hidden">
                                <input type="text" value="YJ003处管线位置与图纸不符" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="text-slate-600 dark:text-slate-400">现场实测并更新图纸</span>
                            </div>
                            <div class="edit-mode hidden">
                                <input type="text" value="现场实测并更新图纸" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="showImagePreview(3)" class="text-primary hover:underline flex items-center gap-1">
                                <span class="material-symbols-outlined text-sm">image</span>
                                查看(5)
                            </button>
                        </td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-600 text-[10px] font-medium border border-emerald-200">
                                    <span class="size-1.5 rounded-full bg-emerald-500"></span>
                                    已处理
                                </span>
                            </div>
                            <div class="edit-mode hidden flex gap-1">
                                <button onclick="saveIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-white bg-primary hover:bg-primary/90 rounded transition-colors">保存</button>
                                <button onclick="cancelIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors">取消</button>
                            </div>
                        </td>
                    </tr>
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" data-issue-id="4">
                        <td class="px-4 py-3 text-slate-700 dark:text-slate-300">4</td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="text-slate-700 dark:text-slate-300">YJ004处存在未知管线</span>
                            </div>
                            <div class="edit-mode hidden">
                                <input type="text" value="YJ004处存在未知管线" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="text-slate-600 dark:text-slate-400">标记位置并上报项目负责人</span>
                            </div>
                            <div class="edit-mode hidden">
                                <input type="text" value="标记位置并上报项目负责人" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="showImagePreview(4)" class="text-primary hover:underline flex items-center gap-1">
                                <span class="material-symbols-outlined text-sm">image</span>
                                查看(1)
                            </button>
                        </td>
                        <td class="px-4 py-3">
                            <div class="view-mode">
                                <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-orange-50 text-orange-600 text-[10px] font-medium border border-orange-200">
                                    <span class="size-1.5 rounded-full bg-orange-500"></span>
                                    处理中
                                </span>
                            </div>
                            <div class="edit-mode hidden flex gap-1">
                                <button onclick="saveIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-white bg-primary hover:bg-primary/90 rounded transition-colors">保存</button>
                                <button onclick="cancelIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors">取消</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="px-4 py-3 border-t border-slate-100 dark:border-slate-800 flex justify-end gap-2 bg-slate-50 dark:bg-[#161e27] shrink-0">
            <button onclick="document.getElementById('surveyIssuesModal').close()" class="px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-200 rounded-lg transition-colors">取消</button>
            <button onclick="document.getElementById('surveyIssuesModal').close()" class="px-3 py-1.5 text-xs font-bold text-white bg-primary hover:bg-primary/90 rounded-lg shadow-lg shadow-primary/20 transition-all">确定</button>
        </div>
    </div>
</dialog>

<!-- 绘制管线模态框 -->
<dialog id="drawPipelineModal" class="bg-transparent backdrop:bg-slate-900/50 backdrop:backdrop-blur-sm p-0 w-full max-w-3xl open:animate-in open:fade-in open:zoom-in-95 closed:animate-out closed:fade-out closed:zoom-out-95 z-[100]">
    <div class="bg-white dark:bg-[#161e27] rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[85vh]">
        <!-- Header -->
        <div class="px-4 py-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center shrink-0">
            <h3 class="text-base font-bold text-slate-800 dark:text-white">绘制管线</h3>
            <button onclick="document.getElementById('drawPipelineModal').close()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                <span class="material-symbols-outlined text-lg">close</span>
            </button>
        </div>
        
        <form method="dialog" class="flex flex-col flex-1 overflow-hidden">
            <div class="p-4 overflow-y-auto custom-scrollbar space-y-5">
                
                <!-- 1. 基本信息 -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-slate-800 dark:text-white flex items-center gap-1.5 pb-1.5 border-b border-slate-100 dark:border-slate-800">
                        <span class="material-symbols-outlined text-primary text-base">info</span>
                        基本信息
                    </h4>
                    <div class="grid grid-cols-3 gap-x-4 gap-y-3">
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">起始点号</label>
                            <input type="text" value="DL001" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            <span class="absolute right-2 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right">(管线点选择或手动输入)</span>
                        </div>
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">终止点号</label>
                            <input type="text" value="DL002" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            <span class="absolute right-2 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right">(智能跟随或自动填入编号)</span>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">埋设方式</label>
                            <select class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="general">一般管线</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">起始埋深</label>
                            <input type="text" value="1.336" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">终止埋深</label>
                            <input type="text" value="2.335" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">权属单位</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            <span class="absolute right-2 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right">(根据目录表自动填入或自填写)</span>
                        </div>
                    </div>
                </div>

                <!-- 2. 管井信息 -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-slate-800 dark:text-white flex items-center gap-1.5 pb-1.5 border-b border-slate-100 dark:border-slate-800">
                        <span class="material-symbols-outlined text-primary text-base">water_drop</span>
                        管井信息
                    </h4>
                    <div class="grid grid-cols-3 gap-x-4 gap-y-3">
                        <!-- 第一行 -->
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">管径/截面</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">套管尺寸</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            <span class="absolute right-2 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right">(选填, 可填写无)</span>
                        </div>
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">套管材质</label>
                            <select class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="plastic">塑料</option>
                            </select>
                            <span class="absolute right-6 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right pointer-events-none">(选填, 可填写无)</span>
                        </div>
                        <!-- 第二行 -->
                        <div class="space-y-1 relative">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">孔径</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                            <span class="absolute right-2 top-[1.6rem] text-red-500 text-[10px] scale-90 origin-right">(选填, 可填写无)</span>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">流向/根数</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">电压/压力</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <!-- 第三行 -->
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">总孔数</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">已用孔数</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">权属孔数</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <!-- 第四行 -->
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">管线材质</label>
                            <select class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                                <option value="copper">铜</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 3. 其他信息 -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-slate-800 dark:text-white flex items-center gap-1.5 pb-1.5 border-b border-slate-100 dark:border-slate-800">
                        <span class="material-symbols-outlined text-primary text-base">description</span>
                        其他信息
                    </h4>
                    <div class="grid grid-cols-3 gap-x-4 gap-y-3">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">线型</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">保护材质</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                        <div class="space-y-1 col-span-3">
                            <label class="text-[10px] font-bold text-slate-500 dark:text-slate-400">备注</label>
                            <input type="text" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                        </div>
                    </div>
                </div>

            </div>

            <div class="px-4 py-3 border-t border-slate-100 dark:border-slate-800 flex justify-end gap-2 bg-slate-50 dark:bg-[#161e27] shrink-0">
                <button value="cancel" formmethod="dialog" class="px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-200 rounded-lg transition-colors">取消</button>
                <button value="confirm" class="px-3 py-1.5 text-xs font-bold text-white bg-primary hover:bg-primary/90 rounded-lg shadow-lg shadow-primary/20 transition-all">确定</button>
            </div>
        </form>
    </div>
</dialog>
<script>
    // 字典数据 - 管点种类和特征值
    const dictData = {
        point_type: [
            { id: 1, code: 'PT_001', name: '电力', value: 'power' },
            { id: 2, code: 'PT_002', name: '排水', value: 'drainage' },
            { id: 3, code: 'PT_003', name: '燃气', value: 'gas' },
            { id: 4, code: 'PT_004', name: '工业', value: 'industrial' },
            { id: 5, code: 'PT_005', name: '通信', value: 'telecom' },
            { id: 6, code: 'PT_006', name: '给水', value: 'water_supply' },
            { id: 7, code: 'PT_007', name: '热力', value: 'heating' },
            { id: 8, code: 'PT_008', name: '其他', value: 'other' }
        ],
        point_feature: [
            // 电力特征值
            { id: 101, name: '一般管线点', value: 'general', parent: 1 },
            { id: 102, name: '转折点', value: 'turning', parent: 1 },
            { id: 103, name: '分支点', value: 'branch', parent: 1 },
            { id: 104, name: '三分支', value: 'three_branch', parent: 1 },
            { id: 105, name: '四分支', value: 'four_branch', parent: 1 },
            { id: 106, name: '五分支', value: 'five_branch', parent: 1 },
            { id: 107, name: '多分支', value: 'multi_branch', parent: 1 },
            { id: 108, name: '预留口', value: 'reserved', parent: 1 },
            { id: 109, name: '非普查', value: 'non_survey', parent: 1 },
            { id: 110, name: '入户', value: 'household', parent: 1 },
            { id: 111, name: '井边点', value: 'well_side', parent: 1 },
            { id: 112, name: '井内点', value: 'well_inside', parent: 1 },
            { id: 113, name: '上杆', value: 'pole_up', parent: 1 },
            { id: 114, name: '拐点', value: 'inflection', parent: 1 },
            { id: 115, name: '弯头', value: 'elbow', parent: 1 },
            { id: 116, name: '出地', value: 'ground_exit', parent: 1 },
            { id: 117, name: '终止点', value: 'end', parent: 1 },

            // 排水特征值
            { id: 201, name: '一般管线点', value: 'general', parent: 2 },
            { id: 202, name: '三通', value: 'three_way', parent: 2 },
            { id: 203, name: '四通', value: 'four_way', parent: 2 },
            { id: 204, name: '五通', value: 'five_way', parent: 2 },
            { id: 205, name: '六通', value: 'six_way', parent: 2 },
            { id: 206, name: '七通', value: 'seven_way', parent: 2 },
            { id: 207, name: '八通', value: 'eight_way', parent: 2 },
            { id: 208, name: '九通', value: 'nine_way', parent: 2 },
            { id: 209, name: '多通', value: 'multi_way', parent: 2 },
            { id: 210, name: '户出', value: 'household_out', parent: 2 },
            { id: 211, name: '入户', value: 'household', parent: 2 },
            { id: 212, name: '起始点', value: 'start', parent: 2 },
            { id: 213, name: '终止点', value: 'end', parent: 2 },
            { id: 214, name: '进水口', value: 'inlet', parent: 2 },
            { id: 215, name: '出水口', value: 'outlet', parent: 2 },
            { id: 216, name: '预留口', value: 'reserved', parent: 2 },
            { id: 217, name: '非普查', value: 'non_survey', parent: 2 },
            { id: 218, name: '出地', value: 'ground_exit', parent: 2 },
            { id: 219, name: '变径', value: 'diameter_change', parent: 2 },
            { id: 220, name: '拐点', value: 'inflection', parent: 2 },
            { id: 221, name: '井边点', value: 'well_side', parent: 2 },
            { id: 222, name: '井内点', value: 'well_inside', parent: 2 },
            { id: 223, name: '沟边点', value: 'ditch_side', parent: 2 },
            { id: 224, name: '连接暗井', value: 'connect_manhole', parent: 2 },
            { id: 225, name: '转折点', value: 'turning', parent: 2 },

            // 燃气特征值
            { id: 301, name: '一般管线点', value: 'general', parent: 3 },
            { id: 302, name: '变径', value: 'diameter_change', parent: 3 },
            { id: 303, name: '出地', value: 'ground_exit', parent: 3 },
            { id: 304, name: '盖堵', value: 'cap', parent: 3 },
            { id: 305, name: '弯头', value: 'elbow', parent: 3 },
            { id: 306, name: '拐点', value: 'inflection', parent: 3 },
            { id: 307, name: '三通', value: 'three_way', parent: 3 },
            { id: 308, name: '四通', value: 'four_way', parent: 3 },
            { id: 309, name: '五通', value: 'five_way', parent: 3 },
            { id: 310, name: '多通', value: 'multi_way', parent: 3 },
            { id: 311, name: '预留口', value: 'reserved', parent: 3 },
            { id: 312, name: '非普查', value: 'non_survey', parent: 3 },
            { id: 313, name: '入户', value: 'household', parent: 3 },
            { id: 314, name: '井边点', value: 'well_side', parent: 3 },
            { id: 315, name: '井内点', value: 'well_inside', parent: 3 },
            { id: 316, name: '起始点', value: 'start', parent: 3 },
            { id: 317, name: '终止点', value: 'end', parent: 3 },
            { id: 318, name: '变深', value: 'depth_change', parent: 3 },

            // 工业特征值
            { id: 401, name: '一般管线点', value: 'general', parent: 4 },
            { id: 402, name: '变径', value: 'diameter_change', parent: 4 },
            { id: 403, name: '出地', value: 'ground_exit', parent: 4 },
            { id: 404, name: '盖堵', value: 'cap', parent: 4 },
            { id: 405, name: '弯头', value: 'elbow', parent: 4 },
            { id: 406, name: '拐点', value: 'inflection', parent: 4 },
            { id: 407, name: '三通', value: 'three_way', parent: 4 },
            { id: 408, name: '四通', value: 'four_way', parent: 4 },
            { id: 409, name: '五通', value: 'five_way', parent: 4 },
            { id: 410, name: '多通', value: 'multi_way', parent: 4 },
            { id: 411, name: '预留口', value: 'reserved', parent: 4 },
            { id: 412, name: '非普查', value: 'non_survey', parent: 4 },
            { id: 413, name: '入户', value: 'household', parent: 4 },
            { id: 414, name: '井边点', value: 'well_side', parent: 4 },
            { id: 415, name: '井内点', value: 'well_inside', parent: 4 },
            { id: 416, name: '起始点', value: 'start', parent: 4 },
            { id: 417, name: '终止点', value: 'end', parent: 4 },
            { id: 418, name: '变深', value: 'depth_change', parent: 4 },

            // 通信特征值
            { id: 501, name: '一般管线点', value: 'general', parent: 5 },
            { id: 502, name: '转折点', value: 'turning', parent: 5 },
            { id: 503, name: '分支点', value: 'branch', parent: 5 },
            { id: 504, name: '三分支', value: 'three_branch', parent: 5 },
            { id: 505, name: '四分支', value: 'four_branch', parent: 5 },
            { id: 506, name: '五分支', value: 'five_branch', parent: 5 },
            { id: 507, name: '多分支', value: 'multi_branch', parent: 5 },
            { id: 508, name: '预留口', value: 'reserved', parent: 5 },
            { id: 509, name: '非普查', value: 'non_survey', parent: 5 },
            { id: 510, name: '入户', value: 'household', parent: 5 },
            { id: 511, name: '井边点', value: 'well_side', parent: 5 },
            { id: 512, name: '井内点', value: 'well_inside', parent: 5 },
            { id: 513, name: '上杆', value: 'pole_up', parent: 5 },
            { id: 514, name: '拐点', value: 'inflection', parent: 5 },
            { id: 515, name: '弯头', value: 'elbow', parent: 5 },
            { id: 516, name: '出地', value: 'ground_exit', parent: 5 },
            { id: 517, name: '终止点', value: 'end', parent: 5 },

            // 给水特征值
            { id: 601, name: '一般管线点', value: 'general', parent: 6 },
            { id: 602, name: '变径', value: 'diameter_change', parent: 6 },
            { id: 603, name: '出地', value: 'ground_exit', parent: 6 },
            { id: 604, name: '盖堵', value: 'cap', parent: 6 },
            { id: 605, name: '弯头', value: 'elbow', parent: 6 },
            { id: 606, name: '拐点', value: 'inflection', parent: 6 },
            { id: 607, name: '三通', value: 'three_way', parent: 6 },
            { id: 608, name: '四通', value: 'four_way', parent: 6 },
            { id: 609, name: '五通', value: 'five_way', parent: 6 },
            { id: 610, name: '多通', value: 'multi_way', parent: 6 },
            { id: 611, name: '预留口', value: 'reserved', parent: 6 },
            { id: 612, name: '非普查', value: 'non_survey', parent: 6 },
            { id: 613, name: '入户', value: 'household', parent: 6 },
            { id: 614, name: '井边点', value: 'well_side', parent: 6 },
            { id: 615, name: '井内点', value: 'well_inside', parent: 6 },
            { id: 616, name: '起始点', value: 'start', parent: 6 },
            { id: 617, name: '终止点', value: 'end', parent: 6 },
            { id: 618, name: '变深', value: 'depth_change', parent: 6 },

            // 热力特征值
            { id: 701, name: '一般管线点', value: 'general', parent: 7 },
            { id: 702, name: '变径', value: 'diameter_change', parent: 7 },
            { id: 703, name: '出地', value: 'ground_exit', parent: 7 },
            { id: 704, name: '盖堵', value: 'cap', parent: 7 },
            { id: 705, name: '弯头', value: 'elbow', parent: 7 },
            { id: 706, name: '拐点', value: 'inflection', parent: 7 },
            { id: 707, name: '三通', value: 'three_way', parent: 7 },
            { id: 708, name: '四通', value: 'four_way', parent: 7 },
            { id: 709, name: '五通', value: 'five_way', parent: 7 },
            { id: 710, name: '多通', value: 'multi_way', parent: 7 },
            { id: 711, name: '预留口', value: 'reserved', parent: 7 },
            { id: 712, name: '非普查', value: 'non_survey', parent: 7 },
            { id: 713, name: '入户', value: 'household', parent: 7 },
            { id: 714, name: '井边点', value: 'well_side', parent: 7 },
            { id: 715, name: '井内点', value: 'well_inside', parent: 7 },
            { id: 716, name: '起始点', value: 'start', parent: 7 },
            { id: 717, name: '终止点', value: 'end', parent: 7 },
            { id: 718, name: '变深', value: 'depth_change', parent: 7 },

            // 其他特征值
            { id: 801, name: '一般管线点', value: 'general', parent: 8 },
            { id: 802, name: '变径', value: 'diameter_change', parent: 8 },
            { id: 803, name: '出地', value: 'ground_exit', parent: 8 },
            { id: 804, name: '盖堵', value: 'cap', parent: 8 },
            { id: 805, name: '弯头', value: 'elbow', parent: 8 },
            { id: 806, name: '拐点', value: 'inflection', parent: 8 },
            { id: 807, name: '三通', value: 'three_way', parent: 8 },
            { id: 808, name: '四通', value: 'four_way', parent: 8 },
            { id: 809, name: '五通', value: 'five_way', parent: 8 },
            { id: 810, name: '多通', value: 'multi_way', parent: 8 },
            { id: 811, name: '预留口', value: 'reserved', parent: 8 },
            { id: 812, name: '非普查', value: 'non_survey', parent: 8 },
            { id: 813, name: '入户', value: 'household', parent: 8 },
            { id: 814, name: '井边点', value: 'well_side', parent: 8 },
            { id: 815, name: '井内点', value: 'well_inside', parent: 8 },
            { id: 816, name: '起始点', value: 'start', parent: 8 },
            { id: 817, name: '终止点', value: 'end', parent: 8 },
            { id: 818, name: '变深', value: 'depth_change', parent: 8 }
        ]
    };

    function handleImageUpload(input) {
        const container = document.getElementById('imageUploadContainer');
        const files = input.files;
        
        if (files) {
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'relative w-20 h-20 rounded-lg overflow-hidden group shrink-0 border border-slate-200 dark:border-slate-700';
                    
                    let content;
                    if (file.type.startsWith('image/')) {
                        content = `<img src="${e.target.result}" class="w-full h-full object-cover">`;
                    } else if (file.type.startsWith('video/')) {
                        content = `<video src="${e.target.result}" class="w-full h-full object-cover"></video><span class="material-symbols-outlined absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white drop-shadow-md">play_circle</span>`;
                    }
                    
                    wrapper.innerHTML = `
                        ${content}
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <button type="button" onclick="this.closest('div.relative').remove()" class="p-1 rounded-full bg-red-500/80 text-white hover:bg-red-600 transition-colors" title="删除">
                                <span class="material-symbols-outlined text-base">delete</span>
                            </button>
                        </div>
                    `;
                    container.appendChild(wrapper);
                };
                reader.readAsDataURL(file);
            });
            input.value = '';
        }
    }

    // 模拟数据源 (与 project-management.html 保持一致)
    const mockProjects = [
        {
            id: 'PROJ-2024-001',
            name: '北区燃气干线探测',
            address: '上海市 · 浦东新区',
            scene: '地下管线普查',
            ownerName: '城市建设投资集团',
            status: 'ongoing',
            startDate: '2024-01-15',
            endDate: '2024-03-15',
            description: '对北区主干道燃气管线进行全面普查，重点排查老化隐患。',
            coordSystem: 'cgcs2000',
            elevSystem: 'wusong',
            contactName: '张建国',
            contactTitle: '项目负责人',
            contactPhone: '13800138000',
            managerIds: '陈明',
            explorationIds: '王强, 周杰',
            dataIds: '李丽',
            reportIds: '孙小美',
            reviewerIds: '陈明'
        },
        {
            id: 'PROJ-2024-002',
            name: '西区供水管网 #2',
            address: '上海市 · 徐汇区',
            scene: '地下管线详查',
            ownerName: '新城区水务有限公司',
            status: 'overdue',
            startDate: '2024-02-20',
            endDate: '2024-04-20',
            description: '配合道路施工进行的供水管网详细探测。',
            contactName: '李华',
            contactTitle: '工程部经理',
            contactPhone: '13912345678'
        },
        {
            id: 'PROJ-2024-003',
            name: '高压电力 HV-404',
            address: '上海市 · 闵行区',
            scene: '地下管线放线测量',
            ownerName: '国家电网上海分公司',
            status: 'completed',
            startDate: '2024-03-10',
            endDate: '2024-05-10',
            description: '新建高压电力线路径放样。',
            contactName: '刘洋',
            contactTitle: '运维主管',
            contactPhone: '13600001111'
        },
        {
            id: 'PROJ-2024-004',
            name: '南区排水系统改造',
            address: '上海市 · 黄浦区',
            scene: '地下管线竣工测量',
            ownerName: '市政工程管理处',
            status: 'suspended',
            startDate: '2024-04-15',
            endDate: '2024-06-15'
        },
        {
            id: 'PROJ-2024-005',
            name: '东区通信光缆布设',
            address: '上海市 · 杨浦区',
            scene: '地下管线普查',
            ownerName: '通信运营商',
            status: 'ongoing',
            startDate: '2024-05-20',
            endDate: '2024-07-20'
        },
        {
            id: 'PROJ-2024-006',
            name: '中央商务区热力管道',
            address: '上海市 · 静安区',
            scene: '地下管线详查',
            ownerName: '热力公司',
            status: 'ongoing',
            startDate: '2024-06-01',
            endDate: '2024-08-01'
        },
        {
            id: 'PROJ-2024-007',
            name: '工业园区燃气支线',
            address: '上海市 · 宝山区',
            scene: '地下管线放线测量',
            ownerName: '燃气集团',
            status: 'overdue',
            startDate: '2024-07-10',
            endDate: '2024-09-10'
        },
        {
            id: 'PROJ-2024-008',
            name: '新城区供水主干网',
            address: '上海市 · 松江区',
            scene: '地下管线竣工测量',
            ownerName: '市自来水公司',
            status: 'completed',
            startDate: '2024-08-05',
            endDate: '2024-10-05'
        }
    ];

    // 状态样式映射
    const statusMap = {
        'ongoing': { text: '实施中', class: 'bg-blue-50 text-blue-600 border-blue-100', dot: 'bg-blue-500 animate-pulse' },
        'overdue': { text: '超期', class: 'bg-orange-50 text-orange-600 border-orange-100', dot: 'bg-orange-500' },
        'completed': { text: '已完成', class: 'bg-emerald-50 text-emerald-600 border-emerald-100', dot: 'bg-emerald-500' },
        'suspended': { text: '停工', class: 'bg-amber-50 text-amber-600 border-amber-100', dot: 'bg-amber-500' },
        'not_started': { text: '未开始', class: 'bg-slate-100 text-slate-600 border-slate-200', dot: 'bg-slate-400' }
    };

    function toggleCard(btn) {
        const content = btn.nextElementSibling;
        const icon = btn.querySelector('.material-symbols-outlined:last-child');
        
        if (content.style.display === 'none') {
            content.style.display = 'block';
            icon.textContent = 'expand_less';
        } else {
            content.style.display = 'none';
            icon.textContent = 'expand_more';
        }
    }

    // 视图切换逻辑
    function switchView(viewName) {
        // 隐藏所有视图
        ['project', 'exploration'].forEach(v => {
            const el = document.getElementById(`view-${v}`);
            if(el) el.classList.add('hidden');
        });
        
        // 显示目标视图
        const target = document.getElementById(`view-${viewName}`);
        if(target) target.classList.remove('hidden');

        // 更新侧边栏状态 (仅针对已实现的视图)
        document.querySelectorAll('nav a').forEach(link => {
            const title = link.getAttribute('title');
            if (!['项目', '勘探'].includes(title)) return;

            const isActive = (viewName === 'project' && title === '项目') || 
                           (viewName === 'exploration' && title === '勘探');

            if (isActive) {
                link.className = 'w-10 h-10 bg-primary/10 text-primary flex items-center justify-center rounded-lg transition-colors group relative';
            } else {
                link.className = 'w-10 h-10 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-700 dark:hover:text-slate-200 flex items-center justify-center rounded-lg transition-colors group relative';
            }
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        // 1. 获取 URL 参数
        const params = new URLSearchParams(window.location.search);
        const projectId = params.get('id');
        const projectName = params.get('name'); // 可选，如果找不到 ID 时的回退

        // 2. 查找项目数据
        let project = null;
        
        // 尝试从 LocalStorage 获取新增项目
        const storedProjects = JSON.parse(localStorage.getItem('mockProjects') || '[]');
        const allProjects = [...mockProjects, ...storedProjects];
        
        if (projectId) {
            project = allProjects.find(p => p.id === projectId);
        }
        
        // 如果按 ID 没找到，尝试按名称匹配 (兼容旧链接)
        if (!project && projectName) {
            project = allProjects.find(p => p.name === projectName);
        }

        // 3. 渲染页面
        if (project) {
            renderProject(project);
            renderQuickSwitchList(allProjects, project.id);
        } else {
            // 404 处理
            document.getElementById('project-title').textContent = '未找到项目';
            document.getElementById('breadcrumb-project-name').textContent = '未找到项目';
        }

        // 4. 绑定侧边栏点击事件
        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', (e) => {
                const title = link.getAttribute('title');
                if (title === '项目') {
                    e.preventDefault();
                    switchView('project');
                } else if (title === '勘探') {
                    e.preventDefault();
                    switchView('exploration');
                }
            });
        });
    });

    function renderQuickSwitchList(projects, currentId) {
        const listContainer = document.getElementById('quick-switch-list');
        listContainer.innerHTML = '';

        projects.forEach(p => {
            const isCurrent = p.id === currentId;
            const item = document.createElement('a');
            item.href = `project-detail.html?id=${p.id}`;
            item.className = `block px-3 py-2 text-sm hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors flex items-center justify-between ${isCurrent ? 'bg-primary/5 text-primary' : 'text-slate-600 dark:text-slate-300'}`;
            item.innerHTML = `
                <span class="truncate flex-1">${p.name}</span>
                ${isCurrent ? '<span class="material-symbols-outlined text-sm">check</span>' : ''}
            `;
            listContainer.appendChild(item);
        });

        // 简单的搜索功能
        const searchInput = document.querySelector('input[placeholder="搜索项目..."]');
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const items = listContainer.querySelectorAll('a');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(term) ? 'flex' : 'none';
            });
        });
    }

    function renderProject(data) {
        // 标题和面包屑
        document.title = `${data.name} - 项目详情`;
        document.getElementById('project-title').textContent = data.name;
        document.getElementById('breadcrumb-project-name').textContent = data.name;
        document.getElementById('project-id').textContent = data.id || '无编号';
        document.getElementById('project-address').textContent = data.address || '未设置地址';

        // 填充卡片数据
        document.getElementById('card-owner').textContent = data.ownerName || '-';
        document.getElementById('card-scene').textContent = data.scene || '-';
        document.getElementById('card-start').textContent = data.startDate || '-';
        document.getElementById('card-end').textContent = data.endDate || '-';
        document.getElementById('card-coord').textContent = data.coordSystem ? (data.coordSystem === 'cgcs2000' ? '2000国家大地坐标系' : data.coordSystem) : '-';
        document.getElementById('card-elev').textContent = data.elevSystem || '-';
        
        // 人员
        document.getElementById('card-p-manager').textContent = data.managerIds || '-';
        document.getElementById('card-p-report').textContent = data.reportIds || '-';
        document.getElementById('card-p-data').textContent = data.dataIds || '-';
        document.getElementById('card-p-explore').textContent = data.explorationIds || '-';

        // 填充勘探页面的现场人员
        const exploreEl = document.getElementById('exploration-personnel');
        if(exploreEl) exploreEl.textContent = data.explorationIds || '未指定';
    }

    // 初始化管点种类下拉框
    function initPointTypeSelect() {
        const pointTypeSelect = document.getElementById('pointTypeSelect');
        if (!pointTypeSelect) return;

        // 清空现有选项
        pointTypeSelect.innerHTML = '<option value="">请选择管点种类</option>';

        // 添加管点种类选项
        dictData.point_type.forEach(type => {
            const option = document.createElement('option');
            option.value = type.id;
            option.textContent = type.name;
            pointTypeSelect.appendChild(option);
        });
    }

    // 更新特征值下拉框（级联）
    function updateFeatureOptions() {
        const pointTypeSelect = document.getElementById('pointTypeSelect');
        const featureSelect = document.getElementById('featureSelect');

        if (!pointTypeSelect || !featureSelect) return;

        const selectedTypeId = parseInt(pointTypeSelect.value);

        // 清空特征值选项
        featureSelect.innerHTML = '<option value="">请选择特征值</option>';

        if (!selectedTypeId) {
            featureSelect.innerHTML = '<option value="">请先选择管点种类</option>';
            return;
        }

        // 根据选中的管点种类筛选特征值
        const features = dictData.point_feature.filter(feature => feature.parent === selectedTypeId);

        // 添加特征值选项
        features.forEach(feature => {
            const option = document.createElement('option');
            option.value = feature.value;
            option.textContent = feature.name;
            featureSelect.appendChild(option);
        });
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        initPointTypeSelect();
    });

    // 处理勘测问题弹窗的操作按钮
    function handleSurveyIssueAction(action) {
        switch(action) {
            case 'modify':
                // 启用所有行的编辑模式
                const rows = document.querySelectorAll('#surveyIssuesTableBody tr[data-issue-id]');
                rows.forEach(row => {
                    row.querySelectorAll('.view-mode').forEach(el => el.classList.add('hidden'));
                    row.querySelectorAll('.edit-mode').forEach(el => el.classList.remove('hidden'));
                });
                break;
            case 'add':
                addNewIssueRow();
                break;
            case 'export':
                alert('导出功能开发中...');
                break;
        }
    }

    // 添加新问题行
    function addNewIssueRow() {
        const tbody = document.getElementById('surveyIssuesTableBody');
        const newId = tbody.children.length + 1;
        const newRow = document.createElement('tr');
        newRow.className = 'hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors bg-blue-50 dark:bg-blue-900/20';
        newRow.setAttribute('data-issue-id', 'new');
        newRow.innerHTML = `
            <td class="px-4 py-3 text-slate-700 dark:text-slate-300">${newId}</td>
            <td class="px-4 py-3">
                <input type="text" placeholder="请输入问题描述" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
            </td>
            <td class="px-4 py-3">
                <input type="text" placeholder="请输入解决方案" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
            </td>
            <td class="px-4 py-3">
                <span class="text-slate-400 text-xs">暂无</span>
            </td>
            <td class="px-4 py-3 flex gap-1">
                <button onclick="saveNewIssue(this)" class="px-2 py-1 text-[10px] font-medium text-white bg-primary hover:bg-primary/90 rounded transition-colors">保存</button>
                <button onclick="cancelNewIssue(this)" class="px-2 py-1 text-[10px] font-medium text-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors">取消</button>
            </td>
        `;
        tbody.insertBefore(newRow, tbody.firstChild);
    }

    // 保存新问题
    function saveNewIssue(btn) {
        const row = btn.closest('tr');
        const inputs = row.querySelectorAll('input[type="text"]');
        const description = inputs[0].value.trim();
        const solution = inputs[1].value.trim();

        if (!description) {
            alert('请输入问题描述');
            return;
        }

        // 这里应该调用API保存数据
        console.log('保存新问题:', { description, solution });

        // 转换为普通行
        const newId = document.querySelectorAll('#surveyIssuesTableBody tr').length;
        row.setAttribute('data-issue-id', newId);
        row.className = 'hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors';
        row.innerHTML = `
            <td class="px-4 py-3 text-slate-700 dark:text-slate-300">${newId}</td>
            <td class="px-4 py-3">
                <div class="view-mode">
                    <span class="text-slate-700 dark:text-slate-300">${description}</span>
                </div>
                <div class="edit-mode hidden">
                    <input type="text" value="${description}" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                </div>
            </td>
            <td class="px-4 py-3">
                <div class="view-mode">
                    <span class="text-slate-600 dark:text-slate-400">${solution || '待补充'}</span>
                </div>
                <div class="edit-mode hidden">
                    <input type="text" value="${solution}" class="w-full px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                </div>
            </td>
            <td class="px-4 py-3">
                <span class="text-slate-400 text-xs">暂无</span>
            </td>
            <td class="px-4 py-3">
                <div class="view-mode">
                    <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-red-50 text-red-600 text-[10px] font-medium border border-red-200">
                        <span class="size-1.5 rounded-full bg-red-500"></span>
                        待处理
                    </span>
                </div>
                <div class="edit-mode hidden flex gap-1">
                    <button onclick="saveIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-white bg-primary hover:bg-primary/90 rounded transition-colors">保存</button>
                    <button onclick="cancelIssueEdit(this)" class="px-2 py-1 text-[10px] font-medium text-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors">取消</button>
                </div>
            </td>
        `;
    }

    // 取消新问题
    function cancelNewIssue(btn) {
        const row = btn.closest('tr');
        row.remove();
    }

    // 保存问题编辑
    function saveIssueEdit(btn) {
        const row = btn.closest('tr');
        const inputs = row.querySelectorAll('.edit-mode input[type="text"]');
        const description = inputs[0].value.trim();
        const solution = inputs[1].value.trim();

        if (!description) {
            alert('问题描述不能为空');
            return;
        }

        // 更新显示内容
        const spans = row.querySelectorAll('.view-mode span');
        spans[0].textContent = description;
        if (spans[1]) spans[1].textContent = solution || '待补充';

        // 切换回查看模式
        row.querySelectorAll('.view-mode').forEach(el => el.classList.remove('hidden'));
        row.querySelectorAll('.edit-mode').forEach(el => el.classList.add('hidden'));

        console.log('保存编辑:', { id: row.getAttribute('data-issue-id'), description, solution });
    }

    // 取消问题编辑
    function cancelIssueEdit(btn) {
        const row = btn.closest('tr');

        // 恢复原始值
        const inputs = row.querySelectorAll('.edit-mode input[type="text"]');
        const spans = row.querySelectorAll('.view-mode span');
        inputs[0].value = spans[0].textContent;
        if (inputs[1] && spans[1]) inputs[1].value = spans[1].textContent;

        // 切换回查看模式
        row.querySelectorAll('.view-mode').forEach(el => el.classList.remove('hidden'));
        row.querySelectorAll('.edit-mode').forEach(el => el.classList.add('hidden'));
    }

    // 模拟影像资料数据
    const surveyIssueImages = {
        1: [
            { type: 'image', url: 'https://via.placeholder.com/400x300/5ad98b/ffffff?text=YJ001-1' },
            { type: 'image', url: 'https://via.placeholder.com/400x300/3b82f6/ffffff?text=YJ001-2' },
            { type: 'video', url: 'https://via.placeholder.com/400x300/f59e0b/ffffff?text=YJ001-Video' }
        ],
        2: [
            { type: 'image', url: 'https://via.placeholder.com/400x300/8b5cf6/ffffff?text=YJ002-1' },
            { type: 'image', url: 'https://via.placeholder.com/400x300/ec4899/ffffff?text=YJ002-2' }
        ],
        3: [
            { type: 'image', url: 'https://via.placeholder.com/400x300/10b981/ffffff?text=YJ003-1' },
            { type: 'image', url: 'https://via.placeholder.com/400x300/f43f5e/ffffff?text=YJ003-2' },
            { type: 'image', url: 'https://via.placeholder.com/400x300/06b6d4/ffffff?text=YJ003-3' },
            { type: 'video', url: 'https://via.placeholder.com/400x300/f97316/ffffff?text=YJ003-Video1' },
            { type: 'video', url: 'https://via.placeholder.com/400x300/84cc16/ffffff?text=YJ003-Video2' }
        ],
        4: [
            { type: 'image', url: 'https://via.placeholder.com/400x300/6366f1/ffffff?text=YJ004-1' }
        ]
    };

    // 当前查看的问题ID
    let currentViewingIssueId = null;

    // 显示影像资料预览
    function showImagePreview(issueId) {
        currentViewingIssueId = issueId;
        const images = surveyIssueImages[issueId] || [];
        const grid = document.getElementById('imagePreviewGrid');
        grid.innerHTML = '';

        images.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'relative group cursor-pointer rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700';

            if (item.type === 'image') {
                div.innerHTML = `
                    <img src="${item.url}" class="w-full h-48 object-cover" alt="影像${index + 1}">
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                        <button onclick="deleteIssueImage(${issueId}, ${index})" class="p-2 bg-red-500 hover:bg-red-600 rounded-full text-white transition-colors">
                            <span class="material-symbols-outlined text-lg">delete</span>
                        </button>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="relative w-full h-48 bg-slate-900 flex items-center justify-center">
                        <img src="${item.url}" class="w-full h-full object-cover opacity-60" alt="视频${index + 1}">
                        <span class="material-symbols-outlined absolute text-white text-5xl">play_circle</span>
                    </div>
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                        <button onclick="deleteIssueImage(${issueId}, ${index})" class="p-2 bg-red-500 hover:bg-red-600 rounded-full text-white transition-colors">
                            <span class="material-symbols-outlined text-lg">delete</span>
                        </button>
                    </div>
                `;
            }
            grid.appendChild(div);
        });

        document.getElementById('imagePreviewModal').showModal();
    }

    // 删除影像资料
    function deleteIssueImage(issueId, index) {
        if (confirm('确定要删除这个影像资料吗？')) {
            surveyIssueImages[issueId].splice(index, 1);
            showImagePreview(issueId);
            updateIssueImageCount(issueId);
        }
    }

    // 添加影像资料
    function addIssueImages() {
        document.getElementById('imagePreviewInput').click();
    }

    // 处理影像资料上传
    function handleImagePreviewUpload(input) {
        const files = input.files;
        if (!files.length || !currentViewingIssueId) return;

        if (!surveyIssueImages[currentViewingIssueId]) {
            surveyIssueImages[currentViewingIssueId] = [];
        }

        Array.from(files).forEach(file => {
            const url = URL.createObjectURL(file);
            const type = file.type.startsWith('video/') ? 'video' : 'image';
            surveyIssueImages[currentViewingIssueId].push({ type, url });
        });

        showImagePreview(currentViewingIssueId);
        updateIssueImageCount(currentViewingIssueId);
        input.value = '';
    }

    // 更新影像资料数量显示
    function updateIssueImageCount(issueId) {
        const count = (surveyIssueImages[issueId] || []).length;
        const row = document.querySelector(`tr[data-issue-id="${issueId}"]`);
        if (row) {
            const btn = row.querySelector('td:nth-child(4) button');
            if (btn) {
                btn.innerHTML = `
                    <span class="material-symbols-outlined text-sm">image</span>
                    查看(${count})
                `;
            }
        }
    }

    // 坐标输入功能
    let currentCoordinatePage = 1;
    const coordinatesPerPage = 10;
    const mockCoordinates = [];

    // 生成模拟坐标数据
    for (let i = 1; i <= 100; i++) {
        mockCoordinates.push({
            id: `DL${String(i).padStart(3, '0')}`,
            x: (2347184 + Math.random() * 1000).toFixed(3),
            y: (434427 + Math.random() * 1000).toFixed(3),
            elevation: (38 + Math.random() * 10).toFixed(2)
        });
    }

    // 载入坐标
    function loadCoordinate(btn) {
        const row = btn.closest('tr');
        const inputs = row.querySelectorAll('input');
        const id = row.querySelector('td:first-child').textContent;
        const x = inputs[0].value;
        const y = inputs[1].value;
        const elevation = inputs[2].value;

        console.log('载入坐标:', { id, x, y, elevation });
        alert(`已载入坐标点 ${id}`);
    }

    // 跳转到指定页
    function goToPage(page) {
        currentCoordinatePage = page;
        renderCoordinateTable();
    }

    // 跳转到自定义页
    function goToCustomPage() {
        const input = document.querySelector('#coordinateInputModal input[type="number"]');
        const page = parseInt(input.value);
        const totalPages = Math.ceil(mockCoordinates.length / coordinatesPerPage);

        if (page >= 1 && page <= totalPages) {
            goToPage(page);
        } else {
            alert(`请输入1-${totalPages}之间的页码`);
        }
    }

    // 渲染坐标表格
    function renderCoordinateTable() {
        const tbody = document.getElementById('coordinateTableBody');
        const start = (currentCoordinatePage - 1) * coordinatesPerPage;
        const end = start + coordinatesPerPage;
        const pageData = mockCoordinates.slice(start, end);

        tbody.innerHTML = pageData.map(coord => `
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                <td class="px-4 py-3 text-center text-slate-700 dark:text-slate-300">${coord.id}</td>
                <td class="px-4 py-3">
                    <input type="text" value="${coord.x}" class="w-full px-2 py-1 text-center bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                </td>
                <td class="px-4 py-3">
                    <input type="text" value="${coord.y}" class="w-full px-2 py-1 text-center bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                </td>
                <td class="px-4 py-3">
                    <input type="text" value="${coord.elevation}" class="w-full px-2 py-1 text-center bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary">
                </td>
                <td class="px-4 py-3 text-center">
                    <button onclick="loadCoordinate(this)" class="text-primary hover:underline text-xs">载入</button>
                </td>
            </tr>
        `).join('');
    }

    // 导入坐标
    function importCoordinates() {
        alert('导入功能开发中...\n支持拖拽Excel/CSV文件导入坐标数据');
    }

    // 导出坐标
    function exportCoordinates() {
        alert('导出功能开发中...\n将导出当前所有坐标数据为Excel文件');
    }

    // 确认坐标
    function confirmCoordinates() {
        console.log('确认坐标数据');
        document.getElementById('coordinateInputModal').close();
    }

    // ==================== 管点搜索功能 ====================

    // 管点搜索
    function searchPoint() {
        const input = document.getElementById('pointSearchInput');
        const pointNumber = input.value.trim();

        if (!pointNumber) {
            alert('请输入管点编号');
            return;
        }

        // 模拟搜索功能
        console.log('搜索管点编号:', pointNumber);

        // 这里应该调用API进行搜索
        // 模拟搜索结果
        alert(`正在搜索管点编号: ${pointNumber}\n\n搜索功能开发中...`);

        // 关闭弹窗
        document.getElementById('pointSearchModal').close();

        // 清空输入框
        input.value = '';
    }

    // ==================== 雷达扫描功能 ====================

    // 设备与项目的绑定关系（模拟数据）
    const deviceProjectMapping = {
        'LD-GTL310-66P': ['WT-250022', 'WT-250024', 'WT-250029'],
        'LD-GTL310-77P': ['WT-250030', 'WT-250055'],
        'LD-GTL310-88P': ['WT-250022', 'WT-250030', 'WT-250055']
    };

    // 项目与数据的绑定关系（模拟数据）
    const projectDataMapping = {
        'WT-250022': ['数据_20251122', '数据_20251123', '数据_20251125'],
        'WT-250024': ['数据_20251123', '数据_20251126'],
        'WT-250029': ['数据_20251125', '数据_20251127', '数据_20251128'],
        'WT-250030': ['数据_20251122', '数据_20251126', '数据_20251128'],
        'WT-250055': ['数据_20251123', '数据_20251127']
    };

    // 当前选中的设备
    let currentSelectedDevice = null;

    // 传输状态管理
    let transferState = {
        isTransferring: false,
        isPaused: false,
        progress: 0,
        intervalId: null
    };

    // 连接设备
    function connectDevice() {
        const selectedDevice = document.querySelector('input[name="device"]:checked');
        if (!selectedDevice) {
            alert('请先选择一个设备');
            return;
        }

        // 模拟设备连接
        const deviceCard = selectedDevice.closest('.p-3');
        const statusIndicator = deviceCard.querySelector('.size-2');
        const statusText = deviceCard.querySelector('.text-\\[10px\\]');

        statusIndicator.classList.remove('bg-slate-400');
        statusIndicator.classList.add('bg-green-500');
        statusText.textContent = '已连接';

        // 保存当前选中的设备
        currentSelectedDevice = selectedDevice.value;

        // 加载该设备绑定的项目
        loadDeviceProjects(currentSelectedDevice);

        alert(`设备 ${selectedDevice.value} 连接成功！`);
    }

    // 加载设备绑定的项目
    function loadDeviceProjects(deviceName) {
        const projects = deviceProjectMapping[deviceName] || [];
        const container = document.getElementById('projectNumberContainer');

        if (projects.length === 0) {
            container.innerHTML = '<span class="text-xs text-slate-400">该设备暂无绑定项目</span>';
            return;
        }

        container.innerHTML = projects.map(project => `
            <label class="inline-flex items-center gap-1.5 px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                <input type="checkbox" value="${project}" class="text-primary focus:ring-primary rounded" onchange="updateProjectSelection()">
                <span class="text-xs text-slate-700 dark:text-slate-300">${project}</span>
            </label>
        `).join('');

        // 清空项目数据选择
        clearProjectData();
    }

    // 更新项目选择
    function updateProjectSelection() {
        const selectedProjects = Array.from(document.querySelectorAll('#projectNumberContainer input:checked')).map(el => el.value);
        console.log('已选择项目:', selectedProjects);

        // 加载选中项目的数据
        loadProjectData(selectedProjects);
    }

    // 加载项目数据
    function loadProjectData(selectedProjects) {
        const container = document.getElementById('projectDataContainer');

        if (selectedProjects.length === 0) {
            container.innerHTML = '<span class="text-xs text-slate-400">请先选择项目编号</span>';
            return;
        }

        // 合并所有选中项目的数据（去重）
        const allData = new Set();
        selectedProjects.forEach(project => {
            const data = projectDataMapping[project] || [];
            data.forEach(d => allData.add(d));
        });

        const dataArray = Array.from(allData).sort();

        if (dataArray.length === 0) {
            container.innerHTML = '<span class="text-xs text-slate-400">所选项目暂无数据</span>';
            return;
        }

        container.innerHTML = dataArray.map(data => `
            <label class="inline-flex items-center gap-1.5 px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                <input type="checkbox" value="${data}" class="text-primary focus:ring-primary rounded" onchange="updateDataSelection()">
                <span class="text-xs text-slate-700 dark:text-slate-300">${data}</span>
            </label>
        `).join('');
    }

    // 清空项目数据
    function clearProjectData() {
        const container = document.getElementById('projectDataContainer');
        container.innerHTML = '<span class="text-xs text-slate-400">请先选择项目编号</span>';
    }

    // 更新数据选择
    function updateDataSelection() {
        const selected = document.querySelectorAll('#projectDataContainer input:checked');
        console.log('已选择项目数据:', Array.from(selected).map(el => el.value));
    }

    // 更新按钮状态
    function updateTransferButtons() {
        const startBtn = document.getElementById('startTransferBtn');
        const pauseBtn = document.getElementById('pauseTransferBtn');
        const resumeBtn = document.getElementById('resumeTransferBtn');

        if (transferState.isTransferring && !transferState.isPaused) {
            // 传输中
            startBtn.disabled = true;
            startBtn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            startBtn.classList.remove('bg-primary', 'hover:bg-primary/90', 'text-white');

            pauseBtn.disabled = false;
            pauseBtn.classList.remove('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            pauseBtn.classList.add('bg-orange-500', 'hover:bg-orange-600', 'text-white');

            resumeBtn.disabled = true;
            resumeBtn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            resumeBtn.classList.remove('bg-primary', 'hover:bg-primary/90', 'text-white');
        } else if (transferState.isPaused) {
            // 已暂停
            startBtn.disabled = true;
            startBtn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            startBtn.classList.remove('bg-primary', 'hover:bg-primary/90', 'text-white');

            pauseBtn.disabled = true;
            pauseBtn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            pauseBtn.classList.remove('bg-orange-500', 'hover:bg-orange-600', 'text-white');

            resumeBtn.disabled = false;
            resumeBtn.classList.remove('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            resumeBtn.classList.add('bg-primary', 'hover:bg-primary/90', 'text-white');
        } else {
            // 未开始
            startBtn.disabled = false;
            startBtn.classList.remove('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            startBtn.classList.add('bg-primary', 'hover:bg-primary/90', 'text-white');

            pauseBtn.disabled = true;
            pauseBtn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            pauseBtn.classList.remove('bg-orange-500', 'hover:bg-orange-600', 'text-white');

            resumeBtn.disabled = true;
            resumeBtn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            resumeBtn.classList.remove('bg-primary', 'hover:bg-primary/90', 'text-white');
        }
    }

    // 更新进度条
    function updateProgress(progress) {
        transferState.progress = progress;
        document.getElementById('transferProgress').textContent = `${progress}%`;
        document.getElementById('transferProgressBar').style.width = `${progress}%`;
    }

    // 开始传输
    function startTransfer() {
        // 检查是否选择了项目、项目数据和数据类型
        const selectedProjects = document.querySelectorAll('#projectNumberContainer input:checked');
        const selectedData = document.querySelectorAll('#projectDataContainer input:checked');
        const selectedDataTypes = document.querySelectorAll('#radarScanModal input[value="基础信息"]:checked, #radarScanModal input[value="图像文件"]:checked');

        if (selectedProjects.length === 0) {
            alert('请至少选择一个项目编号');
            return;
        }
        if (selectedData.length === 0) {
            alert('请至少选择一个项目数据');
            return;
        }
        if (selectedDataTypes.length === 0) {
            alert('请至少选择一个数据类型');
            return;
        }

        transferState.isTransferring = true;
        transferState.isPaused = false;
        transferState.progress = 0;
        updateTransferButtons();
        updateProgress(0);

        // 模拟传输进度
        transferState.intervalId = setInterval(() => {
            if (transferState.progress < 100) {
                updateProgress(transferState.progress + 1);
            } else {
                clearInterval(transferState.intervalId);
                alert('数据传输完成！');
                resetTransfer();
            }
        }, 100);
    }

    // 暂停传输
    function pauseTransfer() {
        if (transferState.intervalId) {
            clearInterval(transferState.intervalId);
            transferState.intervalId = null;
        }
        transferState.isPaused = true;
        transferState.isTransferring = false;
        updateTransferButtons();
    }

    // 继续传输
    function resumeTransfer() {
        transferState.isTransferring = true;
        transferState.isPaused = false;
        updateTransferButtons();

        // 继续模拟传输进度
        transferState.intervalId = setInterval(() => {
            if (transferState.progress < 100) {
                updateProgress(transferState.progress + 1);
            } else {
                clearInterval(transferState.intervalId);
                alert('数据传输完成！');
                resetTransfer();
            }
        }, 100);
    }

    // 重置传输状态
    function resetTransfer() {
        if (transferState.intervalId) {
            clearInterval(transferState.intervalId);
            transferState.intervalId = null;
        }
        transferState.isTransferring = false;
        transferState.isPaused = false;
        transferState.progress = 0;
        updateTransferButtons();
        updateProgress(0);
    }

    // 确认雷达扫描
    function confirmRadarScan() {
        console.log('确认雷达扫描数据');
        document.getElementById('radarScanModal').close();
        resetTransfer();
    }

    // 数据类型选择更新
    function updateDataTypeSelection() {
        const selected = document.querySelectorAll('#radarScanModal input[value="基础信息"]:checked, #radarScanModal input[value="图像文件"]:checked');
        console.log('已选择数据类型:', Array.from(selected).map(el => el.value));
    }
</script>

</body>
</html>
